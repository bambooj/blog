---
title: mysql-logic-graph
date: 2018-04-05 13:12:29
tags:
---
# 逻辑架构图

![http://39.108.10.27/dbe9a02419558159d16e58523d29acbb?q=100](http://39.108.10.27/dbe9a02419558159d16e58523d29acbb?q=100)

MySQL的逻辑架构大致可以分为三层；
## 第一层：客户端层
连接处理、授权认证、安全
## 第二层：核心服务
查询解析、分析、优化、缓存以及所有的内置函数（例如，日期、时间、数学和加密函数），所有跨存储引擎的功能都在这一层实现：视图、触发器、储存过程等。
## 第三层：存储引擎
存储引擎负责 MySQL 中数据的存储和提取，不同存储引擎之间不会相互通信。

# 并发控制
## 读写锁
锁类型：（Shared Lock）共享锁和（Exclusive Lock）排他锁。

共享锁也叫（Read Lock）读锁，排他锁也叫（Write Lock）写锁。
## 锁粒度
（table lock）表锁和（row lock）行锁。

## 事务
数据库事务的ACID特性
* 原子性（atomicity）
* 一致性(consistency)
* 隔离性(isolation)
* 持久性(durability)

### 数据库事务的隔离级别
* READ UNCOMMITED (未提交读)
* READ COMMITED (提交读)；Oracle默认事务隔离级别
* REPEATABLE READ (可重复读)；MySQL默认事务隔离级别
* SERIALIZABLE (可串行化)

### 死锁
什么时候会发生死锁：
1. 当多个事务试图以不同的顺序锁定资源时，就可能会产生死锁；
2. 多个事务同时锁定统一资源时，也会产生死锁。

处理办法：
1. 死锁检测；数据库系统实现了各种死锁检测和死锁超时机制。
2. InnoDB处理死锁方式:将持有最少行级排它锁的事务进行回滚。

    锁的行为和顺序是和存储引擎相关的。
## 多并发版本控制
MySQL的大多数存储引擎实现的都不是简单的行级锁。基于提升并发性能的思考，他们一般实现了多版本并发控制（MVCC）。

InnoDB 的 MVCC，是通过在每行记录后面保存两个隐藏的列来实现的。

## MySQL存储引擎
常用的有两个
* InnoDB 存储引擎
* MyISAM 存储引擎。MySQL5.1 及之前的版本，MyISAM是默认的存储引擎。

MyISAM 特点：提供全文索引、压缩、空间函数（GIS）等；不支持事务和行级锁；崩溃后无法安全恢复。

其他内建存储引擎：Archive、Blackhole、Federated、Memory、Merge、NDB等
第三方存储引擎：OLTP类引擎、面向列的存储引擎、社区存储引擎
    